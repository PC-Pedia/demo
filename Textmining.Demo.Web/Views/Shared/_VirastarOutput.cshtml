@model List<TokenInfo>
@{
    Layout = null;

}
<style>
    .has-suggestions {
        border-bottom: 2px solid #ff0000;
        border-radius: 5px;
        margin-left: 5px;
    }
    /*td{
        border:1px solid #000;
    }*/
    /*tr td:last-child{
        width:1%;
        white-space:nowrap;
    }*/
</style>

@foreach (var tokenInfo in Model)
{
    if (tokenInfo.IsChanged)
    {
        var title = $"<span class='text-mute'>{tokenInfo.EditList.Last().SuggestedText}</span>";
        var content = tokenInfo.EditList.Last().Description;
        if(tokenInfo.EditList.Count > 1)
        {
            title = "<span class='text-mute'>چند پیشنهاد وجود دارد:</span>";
            content = "<table style=\"width: 100%;\">";
            string recomVal = string.Empty;
            string recomComment = string.Empty;

            foreach (EditItem item in tokenInfo.EditList)
            {
                if (item.EditType == EditType.CharReplace || item.EditType == EditType.SpaceCorrection)
                {
                    recomComment += item.Description + "، ";
                    recomVal = item.SuggestedText;
                }
                else
                {
                    if (recomComment.Length > 0)
                    {
                        content += $"<tr><td style=\"padding-left:10px;font-weight:bold\" class=\"block\">{recomVal}</td><td class=\"block\">{recomComment.TrimEnd(' ', '،')}</td></tr>";
                        recomComment = "";
                    }
                    string desc = item.EditType == EditType.SpellCorrection ? "اصلاح اشتباه املائی" : item.Description;
                    content += $"<tr><td style=\"padding-left:10px;font-weight:bold\" class=\"block\">{item.SuggestedText}</td><td class=\"block\">{desc}</td></tr>";
                }
            }
            if (recomComment.Length > 0)
            {
                if (content.Contains("<tr>"))
                {
                    content += $"<tr><td style=\"padding-left:10px;font-weight:bold\" class=\"block\">{recomVal}</td><td class=\"block\">{recomComment.TrimEnd(' ', '،')}</td></tr>";
                    content += "</table>";
                }
                else
                {
                    title = $"<span class='text-mute'>{recomVal}</span>";
                    content = recomComment.TrimEnd(' ', '،');
                }
            }
            else
            {
                content += "</table>";
            }
        }
		<span class="has-suggestions"
			  data-trigger="hover"
			  data-toggle="popover"
			  data-placement="top"
			  data-html="true"
			  title="@title"
			  data-content="@content">
			@tokenInfo.OriginalText
		</span>
    }
    else
    {
        <span class="">
            @tokenInfo.OriginalText
        </span>
    }
}

<partial name="_ErrorReportButton" />

<script>

    $(function () {
        $('span[data-toggle="popover"]').popover();
    })
</script>